    <!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Legacy AI: Your Joyful Legacy, Powered by AI. Celebrate life, relive memories, and shape the future with AI-curated happiness.">
    <meta name="keywords" content="digital scrapbook, AI storytelling, family memories, joyful moments, interactive legacy, family challenges, memory preservation">
    <meta property="og:title" content="Legacy AI - Celebrate Life‚Äôs Joyful Moments">
    <meta property="og:description" content="Create vibrant, interactive digital scrapbooks with Legacy AI. Share happy memories and build family adventures for generations.">
    <meta property="og:image" content="https://ailegacy38-netizen.github.io/images/legacy-ai-og.jpg">
    <meta property="og:url" content="https://ailegacy38-netizen.github.io">
    <meta name="twitter:card" content="summary_large_image">
    <title>Legacy AI - Celebrate Life‚Äôs Joyful Moments</title>
    <link rel="icon" href="/favicon.ico" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-NNX53M7SK6"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());
      gtag('config', 'G-NNX53M7SK6');
    </script>
    <script src="https://www.paypal.com/sdk/js?client-id=AUy9o-ROuIkc6QG09-CFT8H193u_FCVDqGUq0BbVO4Ge1zVbRQfPCs1YEjSAbUI415dRiUhRgYfzQVUW&currency=USD&components=buttons,marks,card-fields"></script>
    <style>
        /* CSS content moved to CSS section */
    </style>
</head>
<body>
    <div class="toast-container"></div>
    <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top">
        <div class="container">
            <a class="navbar-brand" href="#" data-page="home">
                <img src="https://firebasestorage.googleapis.com/v0/b/life-archive-1ed4a.firebasestorage.app/o/images%2Flogo.png?alt=media" alt="Legacy AI" class="img-fluid" style="max-height: 40px;" loading="lazy">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item"><a class="nav-link" href="#" data-page="home">Home</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="moments">Moments That Matter</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="challenges">Family Challenges</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="pricing">Pricing</a></li>
                    <li class="nav-item"><a class="nav-link" href="#" data-page="client-portal">Joyful Portal</a></li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">
                            Language
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#" data-lang="en">English</a></li>
                            <li><a class="dropdown-item" href="#" data-lang="es">Spanish</a></li>
                            <li><a class="dropdown-item" href="#" data-lang="fr">French</a></li>
                            <li><a class="dropdown-item" href="#" data-lang="de">German</a></li>
                            <li><a class="dropdown-item" href="#" data-lang="pt">Portuguese</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>
    <section id="home" class="page-section active">
        <div class="hero text-white py-5 px-3 mt-5">
            <div class="container">
                <h1 data-key="home_title" class="fs-2">Capture Life‚Äôs Joyful Moments with Legacy AI</h1>
                <p class="lead fs-6" data-key="home_lead">Relive the past, celebrate the present, and shape the future with AI-curated happiness. Create Together, Reminisce Forever: Build vibrant digital scrapbooks and happy timelines for generations.</p>
                <div class="d-grid gap-3 d-md-block">
                    <a href="https://firebasestorage.googleapis.com/v0/b/life-archive-1ed4a.firebasestorage.app/o/downloads%2Fjoyful-guide.pdf?alt=media" class="btn btn-outline-light btn-lg w-100 w-md-auto mt-3" download data-key="download_joyful_guide">Download Joyful Memory Guide</a>
</div>
            </div>
        </div>
        <div class="py-5 bg-light px-3">
            <div class="container">
                <h2 class="text-center mb-4 fs-3" data-key="how_it_works_title">How Legacy AI Spreads Joy</h2>
                <div class="row">
                    <div class="col-md-4 text-center mb-4">
                        <h4 data-key="capture_moments_step" class="fs-5">1. Capture Happy Moments</h4>
                        <p data-key="capture_moments_desc">Upload photos, videos, and voice notes of birthdays, trips, and everyday joys.</p>
                    </div>
                    <div class="col-md-4 text-center mb-4">
                        <h4 data-key="create_adventures_step" class="fs-5">2. Create Family Adventures</h4>
                        <p data-key="create_adventures_desc">AI crafts interactive stories and games starring your loved ones.</p>
                    </div>
                    <div class="col-md-4 text-center mb-4">
                        <h4 data-key="build_timeline_step" class="fs-5">3. Build a Happy Timeline</h4>
                        <p data-key="build_timeline_desc">Organize milestones into a vibrant digital scrapbook for all to cherish.</p>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section id="moments" class="page-section">
        <div class="container py-5 px-3">
            <h2 class="text-center mb-4 fs-3" data-key="moments_title">Moments That Matter</h2>
            <p class="lead text-center" data-key="moments_intro">Relive the joy of birthdays, family trips, inside jokes, and everyday moments. Upload your happiest memories to create a digital scrapbook that sparks smiles.</p>
            <div class="row">
                <div class="col-12 col-sm-6 col-md-4 mb-4">
                    <div class="card p-3 text-center">
                        <h4 data-key="upload_photos_title" class="fs-5">Photos of Joy</h4>
                        <p data-key="upload_photos_desc">Share snapshots of laughter and love.</p>
                        <input type="file" class="form-control mb-2" accept="image/*" id="uploadPhotoInput" multiple>
                        <textarea class="form-control mb-2" id="photoEmotionInput" data-placeholder-key="emotion_tag_placeholder" placeholder="Tag emotions or themes (e.g., #joyful, #adventure)"></textarea>
                        <button class="btn btn-joyful btn-lg w-100" data-key="upload_now" id="uploadPhotoButton">Upload Now</button>
                        <div class="progress-container" id="photoProgressContainer"><div class="progress-bar" id="photoProgressBar">0%</div></div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 mb-4">
                    <div class="card p-3 text-center">
                        <h4 data-key="record_voice_title" class="fs-5">Voice Notes</h4>
                        <p data-key="record_voice_desc">Capture jokes, songs, or heartfelt messages.</p>
                        <textarea class="form-control mb-2" id="voiceEmotionInput" data-placeholder-key="emotion_tag_placeholder" placeholder="Tag emotions or themes (e.g., #laughter, #wisdom)"></textarea>
                        <button class="btn btn-joyful btn-lg w-100" data-key="record_now" id="recordVoiceButton">Record Now</button>
                        <button class="btn btn-outline-joyful btn-lg w-100 mt-2" data-key="stop_recording" id="stopRecordingButton" style="display: none;">Stop Recording</button>
                        <div class="mt-2" id="recordingTimer" style="display: none;">00:00</div>
                        <audio controls id="audioPreview" class="w-100 mt-2" style="display: none;"></audio>
                        <div class="progress-container" id="voiceProgressContainer"><div class="progress-bar" id="voiceProgressBar">0%</div></div>
                    </div>
                </div>
                <div class="col-12 col-sm-6 col-md-4 mb-4">
                    <div class="card p-3 text-center">
                        <h4 data-key="share_videos_title" class="fs-5">Happy Videos</h4>
                        <p data-key="share_videos_desc">Upload clips of celebrations and adventures.</p>
                        <input type="file" class="form-control mb-2" accept="video/*" id="uploadVideoInput" multiple>
                        <textarea class="form-control mb-2" id="videoEmotionInput" data-placeholder-key="emotion_tag_placeholder" placeholder="Tag emotions or themes (e.g., #celebration, #travel)"></textarea>
                        <button class="btn btn-joyful btn-lg w-100" data-key="upload_now" id="uploadVideoButton">Upload Now</button>
                        <div class="progress-container" id="videoProgressContainer"><div class="progress-bar" id="videoProgressBar">0%</div></div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section id="challenges" class="page-section">
        <div class="container py-5 px-3">
            <h2 class="text-center mb-4 fs-3" data-key="challenges_title">Interactive Family Challenges</h2>
            <p class="lead text-center" data-key="challenges_intro">Bring your family closer with fun prompts that create joyful memories. Complete challenges and build a positive archive together!</p>
            <div class="row">
                <div class="col-12 col-md-4 mb-4">
                    <div class="card p-4 text-center">
                        <h4 data-key="funny_question_title" class="fs-5">Funny Question Challenge</h4>
                        <p data-key="funny_question_desc">Ask your grandparents one hilarious question today and record their answer!</p>
                        <textarea class="form-control mb-2" id="funnyQuestionResponse" placeholder="Your family's answer..."></textarea>
                        <button class="btn btn-joyful btn-lg w-100" data-key="start_challenge" data-challenge-id="funny-question">Submit Response</button>
                    </div>
                </div>
                <div class="col-12 col-md-4 mb-4">
                    <div class="card p-4 text-center">
                        <h4 data-key="dance_off_title" class="fs-5">Family Dance-Off</h4>
                        <p data-key="dance_off_desc">Record a 60-second family dance-off and share the fun!</p>
                        <input type="file" class="form-control mb-2" accept="video/*" id="danceOffVideoInput">
                        <button class="btn btn-joyful btn-lg w-100" data-key="start_challenge" data-challenge-id="dance-off">Upload Video</button>
                    </div>
                </div>
                <div class="col-12 col-md-4 mb-4">
                    <div class="card p-4 text-center">
                        <h4 data-key="childhood_memory_title" class="fs-5">Childhood Memory Story</h4>
                        <p data-key="childhood_memory_desc">Share a 60-second story of your happiest childhood moment.</p>
                        <textarea class="form-control mb-2" id="childhoodMemoryResponse" placeholder="Your story..."></textarea>
                        <button class="btn btn-joyful btn-lg w-100" data-key="start_challenge" data-challenge-id="childhood-memory">Submit Story</button>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <section id="pricing" class="page-section">
        <div class="container py-5 px-3">
            <h2 class="text-center mb-4 fs-3" data-key="pricing_title">Choose Your Joyful Plan</h2>
            <p class="text-center mb-5" data-key="pricing_intro">Start free or unlock premium features to create unforgettable family memories.</p>
            <div id="plan-status" class="alert alert-info text-center" style="display: none;"></div>
            <div class="row row-cols-1 row-cols-md-4 g-4">
                <div class="col">
                    <div class="card h-100 text-center">
                        <div class="card-body">
                            <h3 data-key="free_tier_title">Basic Legacy</h3>
                            <p data-key="free_tier_desc">Limited text & photo archive, AI memory highlights, 5 AI interactions/month.</p>
                            <p class="display-4 fw-bold">$0</p>
                            <button class="btn btn-joyful plan-button" data-key="get_started_free" data-plan="basic">Get Started Free</button>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card h-100 text-center">
                        <div class="card-body">
                            <h3 data-key="essential_tier_title">Essential Legacy</h3>
                            <p data-key="essential_tier_desc">Expanded storage, custom AI persona, multi-language support, mood-based search.</p>
                            <p class="display-4 fw-bold">$15/mo</p>
                            <div class="paypal-buttons-container" id="paypal-essential"></div>
                            <div class="card-fields-container" id="card-fields-essential">
                                <div class="card-field">
                                    <label for="card-number-essential">Card Number</label>
                                    <div id="card-number-essential" class="card-field-input"></div>
                                </div>
                                <div class="card-field">
                                    <label for="card-expiry-essential">Expiration Date</label>
                                    <div id="card-expiry-essential" class="card-field-input"></div>
                                </div>
                                <div class="card-field">
                                    <label for="card-cvv-essential">CVV</label>
                                    <div id="card-cvv-essential" class="card-field-input"></div>
                                </div>
                                <button class="card-submit-button" id="card-submit-essential">Pay with Card</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card h-100 text-center">
                        <div class="card-body">
                            <h3 data-key="family_tier_title">Family Legacy Plus</h3>
                            <p data-key="family_tier_desc">Shared archives, collaborative scrapbooks, unlimited AI interactions, family games.</p>
                            <p class="display-4 fw-bold">$39/mo</p>
                            <div class="paypal-buttons-container" id="paypal-family"></div>
                            <div class="card-fields-container" id="card-fields-family">
                                <div class="card-field">
                                    <label for="card-number-family">Card Number</label>
                                    <div id="card-number-family" class="card-field-input"></div>
                                </div>
                                <div class="card-field">
                                    <label for="card-expiry-family">Expiration Date</label>
                                    <div id="card-expiry-family" class="card-field-input"></div>
                                </div>
                                <div class="card-field">
                                    <label for="card-cvv-family">CVV</label>
                                    <div id="card-cvv-family" class="card-field-input"></div>
                                </div>
                                <button class="card-submit-button" id="card-submit-family">Pay with Card</button>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col">
                    <div class="card h-100 text-center">
                        <div class="card-body">
                            <h3 data-key="lifetime_tier_title">Lifetime Legacy Vault</h3>
                            <p data-key="lifetime_tier_desc">Unlimited storage, AI legacy book, priority support, scheduled messages, and **exclusive VIP family support with personalized AI memory curations.**</p>
                            <p class="display-4 fw-bold">$299</p>
                            <div class="paypal-buttons-container" id="paypal-lifetime"></div>
                            <div class="card-fields-container" id="card-fields-lifetime">
                                <div class="card-field">
                                    <label for="card-number-lifetime">Card Number</label>
                                    <div id="card-number-lifetime" class="card-field-input"></div>
                                </div>
                                <div class="card-field">
                                    <label for="card-expiry-lifetime">Expiration Date</label>
                                    <div id="card-expiry-lifetime" class="card-field-input"></div>
                                </div>
                                <div class="card-field">
                                    <label for="card-cvv-lifetime">CVV</label>
                                    <div id="card-cvv-lifetime" class="card-field-input"></div>
                                </div>
                                <button class="card-submit-button" id="card-submit-lifetime">Pay with Card</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-5">
                <h3 data-key="one_time_title">Premium Enhancements</h3>
                <p data-key="one_time_desc">Add unique features to your joyful legacy.</p>
                <div class="row">
                    <div class="col-md-4 mb-4">
                        <p data-key="storybook_purchase">AI Storybook ($99)</p>
                        <div class="paypal-buttons-container" id="paypal-storybook"></div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <p data-key="time_capsule_purchase">Time Capsule ($49)</p>
                        <div class="paypal-buttons-container" id="paypal-timecapsule"></div>
                    </div>
                    <div class="col-md-4 mb-4">
                        <p data-key="video_message_purchase">Legacy Video ($79)</p>
                        <div class="paypal-buttons-container" id="paypal-legacyvideo"></div>
                    </div>
                </div>
            </div>
            <div class="text-center mt-5">
                <h3 data-key="business_creator_title">For Businesses & Creators</h3>
                <p data-key="business_creator_desc">Preserve brand stories or create unique AI personas.</p>
                <p data-key="business_plan">Business Plan: $499/year</p>
                <p data-key="creator_plan">Creator Plan: $99 setup + $25/mo</p>
                <p data-key="community_plan">Community Vault: $149/year</p>
                <button class="btn btn-joyful" data-key="contact_sales">Contact Sales</button>
            </div>
            <div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="successModalLabel">Success!</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            Your subscription was successful! Welcome to Legacy AI!
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <div class="modal fade" id="errorModal" tabindex="-1" aria-labelledby="errorModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="errorModalLabel">Error</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <span id="errorMessage"></span>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
            <div id="infoMessageContainer" class="mt-3"></div>
        </div>
    </section>
    <section id="client-portal" class="page-section">
        <div class="container py-5 px-3">
            <div class="client-portal-section" id="login-form">
                <h2 class="text-center mb-4 fs-3" data-key="login_title">Joyful Portal Login</h2>
                <form id="loginForm">
                    <div class="mb-3">
                        <label for="clientEmail" class="form-label" data-key="email_label">Email</label>
                        <input type="email" class="form-control" id="clientEmail" data-placeholder-key="email_input_placeholder" placeholder="Email" required>
                    </div>
                    <div class="mb-3">
                        <label for="clientPassword" class="form-label" data-key="password_label">Password</label>
                        <input type="password" class="form-control" id="clientPassword" data-placeholder-key="password_input_placeholder" placeholder="Password" required>
                    </div>
                    <button type="submit" class="btn btn-joyful w-100" data-key="login_button">Login</button>
                    <div class="text-center mt-3">
                        <a href="#" data-key="forgot_password">Forgot Password?</a> | <a href="#" id="showSignup" data-key="signup_link">Sign Up</a>
                    </div>
                    <div id="loginError" class="alert alert-danger mt-3 d-none"></div>
                </form>
            </div>
            <div class="client-portal-section" id="signup-form" style="display: none;">
                <h2 class="text-center mb-4 fs-3" data-key="signup_title">Sign Up for Joyful Portal</h2>
                <form id="signupForm">
                    <div class="mb-3">
                        <label for="signupEmail" class="form-label" data-key="email_label">Email</label>
                        <input type="email" class="form-control" id="signupEmail" data-placeholder-key="email_input_placeholder" placeholder="Email" required>
                    </div>
                    <div class="mb-3">
                        <label for="signupPassword" class="form-label" data-key="password_label">Password</label>
                        <input type="password" class="form-control" id="signupPassword" data-placeholder-key="password_input_placeholder" placeholder="Password" required>
                    </div>
                    <button type="submit" class="btn btn-joyful w-100" data-key="signup_button">Sign Up</button>
                    <div class="text-center mt-3">
                        <a href="#" id="showLogin" data-key="login_link">Already have an account? Login</a>
                    </div>
                    <div id="signupError" class="alert alert-danger mt-3 d-none"></div>
                </form>
            </div>
            <div class="client-portal-dashboard" id="dashboard-content">
                <h2 class="mb-4" data-key="welcome_user">Welcome, <span id="userName"></span>!</h2>
                <div class="row">
                    <div class="col-md-6 mb-4">
                        <div class="card p-4">
                            <h4 data-key="happy_timeline_title" class="fs-5">Your Happy Timeline</h4>
                            <p data-key="happy_timeline_desc">Add milestones, firsts, and joyful moments to your digital scrapbook.</p>
                            <button class="btn btn-joyful" data-key="add_milestone" id="addMilestoneButton">Add Milestone</button>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card p-4">
                            <h4 data-key="bucket_list_title" class="fs-5">Family Bucket List</h4>
                            <p data-key="bucket_list_desc">Set shared goals like trips or fun activities and track progress!</p>
                            <input type="text" class="form-control mb-2" id="goalInput" data-placeholder-key="add_goal_placeholder" placeholder="Add a goal...">
                            <button class="btn btn-joyful" data-key="add_goal" id="addGoalButton">Add Goal</button>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card p-4">
                            <h4 data-key="storytelling_mode_title" class="fs-5">AI Storytelling Adventure</h4>
                            <p data-key="storytelling_mode_desc">Your co-pilot in crafting your family‚Äôs unique journey, creating fun, fictional stories with your loved ones as heroes!</p>
                            <div class="mb-3">
                                <label for="storyCharacters" class="form-label" data-key="story_characters_label">Who are the main characters?</label>
                                <input type="text" class="form-control" id="storyCharacters" data-placeholder-key="story_characters_placeholder" placeholder="e.g., Mom, Dad, Lily, our dog Sparky">
                            </div>
                            <div class="mb-3">
                                <label for="storyTheme" class="form-label" data-key="story_theme_label">Choose a theme:</label>
                                <select class="form-select" id="storyTheme">
                                    <option value="" data-key="select_theme_option">Select a theme</option>
                                    <option value="adventure">Adventure</option>
                                    <option value="mystery">Mystery</option>
                                    <option value="comedy">Comedy</option>
                                </select>
                            </div>
                            <button class="btn btn-joyful" data-key="generate_story" id="generateStoryButton">Generate Story</button>
                            <div id="storyOutput" class="mt-3 p-3 border rounded" style="display: none;"></div>
                            <div class="d-flex justify-content-center mt-3" id="storyActions" style="display: none;">
                                <button class="btn btn-outline-joyful me-2" id="saveStoryButton">Save Story</button>
                                <button class="btn btn-outline-joyful me-2" id="shareStoryButton">Share Story</button>
                                <button class="btn btn-outline-joyful" id="regenerateStoryButton">Regenerate Story</button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card p-4">
                            <h4 data-key="challenge_response_title" class="fs-5">Respond to Challenges</h4>
                            <p data-key="challenge_response_desc">View and respond to family challenges.</p>
                            <button class="btn btn-joyful" data-key="view_challenges">View Challenges</button>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card p-4">
                            <h4 data-key="account_settings_title" class="fs-5">Account Settings</h4>
                            <p data-key="account_settings_desc">Manage your profile, subscription, and preferences.</p>
                            <button class="btn btn-joyful" data-key="manage_settings">Manage Settings</button>
                        </div>
                    </div>
                    <div class="col-md-6 mb-4">
                        <div class="card p-4">
                            <h4 data-key="contact_support_title" class="fs-5">Support</h4>
                            <p data-key="contact_support_desc">Get help or provide feedback.</p>
                            <button class="btn btn-joyful" data-key="contact_us">Contact Us</button>
                        </div>
                    </div>
                </div>
                <p class="text-center mt-3">
                    <a href="#" class="btn btn-outline-secondary" id="logoutButton" data-key="logout_button">Logout</a>
                </p>
            </div>
            <div id="demo-content" class="text-center mt-5">
                <h2 data-key="demo_timeline_title">Preview a Happy Timeline</h2>
                <p data-key="demo_timeline_desc">See how Legacy AI brings memories to life!</p>
                <div class="row mt-4">
                    <div class="col-md-4 mb-4">
                        <img src="https://firebasestorage.googleapis.com/v0/b/YOUR_FIREBASE_STORAGE_BUCKET/o/images%2Fdemo-timeline-1.jpg?alt=media" alt="Memory 1" class="img-fluid rounded shadow" loading="lazy">
                        <p class="mt-2 text-muted">#BirthdayJoy</p>
                    </div>
                    <div class="col-md-4 mb-4">
                        <img src="https://firebasestorage.googleapis.com/v0/b/YOUR_FIREBASE_STORAGE_BUCKET/o/images%2Fdemo-timeline-2.jpg?alt=media" alt="Memory 2" class="img-fluid rounded shadow" loading="lazy">
                        <p class="mt-2 text-muted">#FamilyAdventure</p>
                    </div>
                    <div class="col-md-4 mb-4">
                        <audio controls class="w-100" id="demoAudioPlayer">
                            <source src="https://firebasestorage.googleapis.com/v0/b/life-archive-1ed4a.firebasestorage.app/o/audio%2Fdemo-voice-note.mp3?alt=media" type="audio/mpeg">
                            Your browser does not support the audio element.
                        </audio>
                        <p class="mt-2 text-muted">#Laughter #Wisdom</p>
                    </div>
                </div>
                <p class="text-center mt-3">
                    <a href="#" data-page="client-portal" class="btn btn-joyful" data-key="login_to_create">Login to Create Your Own</a>
                </p>
            </div>
        </div>
    </section>
    <footer class="footer py-4 mt-5">
        <div class="container text-center">
            <p>¬© <span id="current-year"></span> Legacy AI. All rights reserved.</p>
        </div>
    </footer>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-app.js";
  import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, sendPasswordResetEmail, signOut } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-auth.js";
  import { getFirestore, collection, doc, getDoc, setDoc, updateDoc, addDoc, serverTimestamp } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-firestore.js";
  import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/12.4.0/firebase-storage.js";

  // Your web app's Firebase configuration
  // For Firebase JS SDK v7.20.0 and later, measurementId is optional
  const firebaseConfig = {
    apiKey: "AIzaSyAI5Sn4rTmQ_un5baTyfduewlqaAiOibiQ",
    authDomain: "life-archive-1ed4a.firebaseapp.com",
    projectId: "life-archive-1ed4a",
    storageBucket: "life-archive-1ed4a.firebasestorage.app",
    messagingSenderId: "999843492181",
    appId: "1:999843492181:web:0defdcd915cd6dd4273fdc",
    measurementId: "G-NNX53M7SK6"
  };

  // Initialize Firebase
  const app = initializeApp(firebaseConfig);
  const authService = getAuth(app);
  const firestore = getFirestore(app);
  const storageService = getStorage(app);
  let mediaRecorder = null;
  let audioChunks = [];
  let audioBlob = null;
  let recordingTimerInterval = null;
  let recordingStartTime = 0;
  let currentLang = 'en'; // Default language

  // Function to display toast notifications
  function showToast(message, type = 'info') {
      const toastContainer = document.querySelector('.toast-container');
      const toast = document.createElement('div');
      toast.classList.add('toast', 'align-items-center', 'text-white', 'border-0');
      if (type === 'success') {
          toast.classList.add('bg-success');
      } else if (type === 'error') {
          toast.classList.add('bg-danger');
      } else {
          toast.classList.add('bg-info');
      }
      toast.setAttribute('role', 'alert');
      toast.setAttribute('aria-live', 'assertive');
      toast.setAttribute('aria-atomic', 'true');
      toast.innerHTML = `
          <div class="d-flex">
              <div class="toast-body">${message}</div>
              <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
          </div>
      `;
      toastContainer.appendChild(toast);
      const bootstrapToast = new bootstrap.Toast(toast, { delay: 3000 });
      bootstrapToast.show();
      toast.addEventListener('hidden.bs.toast', () => {
          toast.remove();
      });
  }

  const translations = {
      en: {
          home_title: "Capture Life‚Äôs Joyful Moments with Legacy AI",
          home_lead: "Relive the past, celebrate the present, and shape the future with AI-curated happiness. Create Together, Reminisce Forever: Build vibrant digital scrapbooks and happy timelines for generations.",
          get_started_free: "Get Started Free",
          download_joyful_guide: "Download Joyful Memory Guide",
          how_it_works_title: "How Legacy AI Spreads Joy",
          capture_moments_step: "1. Capture Happy Moments",
          capture_moments_desc: "Upload photos, videos, and voice notes of birthdays, trips, and everyday joys.",
          create_adventures_step: "2. Create Family Adventures",
          create_adventures_desc: "AI crafts interactive stories and games starring your loved ones.",
          build_timeline_step: "3. Build a Happy Timeline",
          build_timeline_desc: "Organize milestones into a vibrant digital scrapbook for all to cherish.",
          moments_title: "Moments That Matter",
          moments_intro: "Relive the joy of birthdays, family trips, inside jokes, and everyday moments. Upload your happiest memories to create a digital scrapbook that sparks smiles.",
          upload_photos_title: "Photos of Joy",
          upload_photos_desc: "Share snapshots of laughter and love.",
          record_voice_title: "Voice Notes",
          record_voice_desc: "Capture jokes, songs, or heartfelt messages.",
          share_videos_title: "Happy Videos",
          share_videos_desc: "Upload clips of celebrations and adventures.",
          emotion_tag_placeholder: "Tag emotions or themes (e.g., #joyful, #adventure)",
          upload_now: "Upload Now",
          record_now: "Record Now",
          stop_recording: "Stop Recording",
          upload_failed: "Upload failed:",
          upload_success: "Voice note uploaded successfully! MP3 conversion in progress.",
          mp3_conversion_failed: "Voice note uploaded, but MP3 conversion failed. Playing WebM.",
          microphone_error: "Microphone access denied or unavailable: ",
          challenges_title: "Interactive Family Challenges",
          challenges_intro: "Bring your family closer with fun prompts that create joyful memories. Complete challenges and build a positive archive together!",
          funny_question_title: "Funny Question Challenge",
          funny_question_desc: "Ask your grandparents one hilarious question today and record their answer!",
          dance_off_title: "Family Dance-Off",
          dance_off_desc: "Record a 60-second family dance-off and share the fun!",
          childhood_memory_title: "Childhood Memory Story",
          childhood_memory_desc: "Share a 60-second story of your happiest childhood moment.",
          start_challenge: "Submit Response",
          pricing_title: "Choose Your Joyful Plan",
          pricing_intro: "Start free or unlock premium features to create unforgettable family memories.",
          free_tier_title: "Basic Legacy",
          free_tier_desc: "Limited text & photo archive, AI memory highlights, 5 AI interactions/month.",
          essential_tier_title: "Essential Legacy",
          essential_tier_desc: "Expanded storage, custom AI persona, multi-language support, mood-based search.",
          family_tier_title: "Family Legacy Plus",
          family_tier_desc: "Shared archives, collaborative scrapbooks, unlimited AI interactions, family games.",
          lifetime_tier_title: "Lifetime Legacy Vault",
          lifetime_tier_desc: "Unlimited storage, AI legacy book, priority support, scheduled messages, and **exclusive VIP family support with personalized AI memory curations.**",
          buy_now: "Buy Now",
          one_time_title: "Premium Enhancements",
          one_time_desc: "Add unique features to your joyful legacy.",
          storybook_purchase: "AI Storybook ($99)",
          time_capsule_purchase: "Time Capsule ($49)",
          video_message_purchase: "Legacy Video ($79)",
          business_creator_title: "For Businesses & Creators",
          business_creator_desc: "Preserve brand stories or create unique AI personas.",
          business_plan: "Business Plan: $499/year",
          creator_plan: "Creator Plan: $99 setup + $25/mo",
          community_plan: "Community Vault: $149/year",
          contact_sales: "Contact Sales",
          login_title: "Joyful Portal Login",
          email_label: "Email",
          email_input_placeholder: "Email",
          password_label: "Password",
          password_input_placeholder: "Password",
          login_button: "Login",
          forgot_password: "Forgot Password?",
          email_required: "Please enter your email address.",
          password_reset_sent: "Password reset email sent! Check your inbox.",
          login_required: "Please log in to record a...",
          current_plan: "You're on {{planName}} üíõ",
          welcome_user: "Welcome, !", // Added for functionality, placeholder for user name
          happy_timeline_title: "Your Happy Timeline",
          happy_timeline_desc: "Add milestones, firsts, and joyful moments to your digital scrapbook.",
          add_milestone: "Add Milestone",
          bucket_list_title: "Family Bucket List",
          bucket_list_desc: "Set shared goals like trips or fun activities and track progress!",
          add_goal_placeholder: "Add a goal...",
          add_goal: "Add Goal",
          storytelling_mode_title: "AI Storytelling Adventure",
          storytelling_mode_desc: "Your co-pilot in crafting your family‚Äôs unique journey, creating fun, fictional stories with your loved ones as heroes!",
          story_characters_label: "Who are the main characters?",
          story_characters_placeholder: "e.g., Mom, Dad, Lily, our dog Sparky",
          story_theme_label: "Choose a theme:",
          select_theme_option: "Select a theme",
          generate_story: "Generate Story",
          challenge_response_title: "Respond to Challenges",
          challenge_response_desc: "View and respond to family challenges.",
          view_challenges: "View Challenges",
          account_settings_title: "Account Settings",
          account_settings_desc: "Manage your profile, subscription, and preferences.",
          manage_settings: "Manage Settings",
          contact_support_title: "Support",
          contact_support_desc: "Get help or provide feedback.",
          contact_us: "Contact Us",
          logout_button: "Logout",
          demo_timeline_title: "Preview a Happy Timeline",
          demo_timeline_desc: "See how Legacy AI brings memories to life!",
          login_to_create: "Login to Create Your Own",
          signup_title: "Sign Up for Joyful Portal",
          signup_button: "Sign Up",
          signup_link: "Sign Up",
          login_link: "Already have an account? Login"
      },
      es: {
          home_title: "Captura los Momentos Alegres de la Vida con Legacy AI",
          home_lead: "Revive el pasado, celebra el presente y moldea el futuro con felicidad curada por IA. Crea Juntos, Recuerda Para Siempre: Construye √°lbumes digitales vibrantes y l√≠neas de tiempo felices para generaciones.",
          get_started_free: "Comienza Gratis",
          download_joyful_guide: "Descargar Gu√≠a de Memoria Alegre",
          how_it_works_title: "C√≥mo Legacy AI Difunde la Alegr√≠a",
          capture_moments_step: "1. Captura Momentos Felices",
          capture_moments_desc: "Sube fotos, videos y notas de voz de cumplea√±os, viajes y alegr√≠as cotidianas.",
          create_adventures_step: "2. Crea Aventuras Familiares",
          create_adventures_desc: "IA crea historias interactivas y juegos protagonizados por tus seres queridos.",
          build_timeline_step: "3. Construye una L√≠nea de Tiempo Feliz",
          build_timeline_desc: "Organiza hitos en un √°lbum digital vibrante para que todos lo atesoren.",
          moments_title: "Momentos Que Importan",
          moments_intro: "Revive la alegr√≠a de cumplea√±os, viajes familiares, chistes internos y momentos cotidianos. Sube tus recuerdos m√°s felices para crear un √°lbum digital que provoque sonrisas.",
          upload_photos_title: "Fotos de Alegr√≠a",
          upload_photos_desc: "Comparte instant√°neas de risas y amor.",
          record_voice_title: "Notas de Voz",
          record_voice_desc: "Captura chistes, canciones o mensajes sinceros.",
          share_videos_title: "Videos Felices",
          share_videos_desc: "Sube clips de celebraciones y aventuras.",
          emotion_tag_placeholder: "Etiqueta emociones o temas (e.g., #alegre, #aventura)",
          upload_now: "Subir Ahora",
          record_now: "Grabar Ahora",
          stop_recording: "Detener Grabaci√≥n",
          upload_failed: "Subida fallida:",
          upload_success: "Nota de voz subida con √©xito! Conversi√≥n a MP3 en progreso.",
          mp3_conversion_failed: "Nota de voz subida, pero conversi√≥n a MP3 fallida. Reproduciendo WebM.",
          microphone_error: "Acceso al micr√≥fono denegado o no disponible: ",
          challenges_title: "Desaf√≠os Familiares Interactivos",
          challenges_intro: "Ac√©rcate a tu familia con prompts divertidos que crean recuerdos alegres. Completa desaf√≠os y construye un archivo positivo juntos!",
          funny_question_title: "Desaf√≠o de Pregunta Divertida",
          funny_question_desc: "Preg√∫ntale a tus abuelos una pregunta hilarante hoy y graba su respuesta!",
          dance_off_title: "Baile Familiar",
          dance_off_desc: "Graba un baile familiar de 60 segundos y comparte la diversi√≥n!",
          childhood_memory_title: "Historia de Memoria Infantil",
          childhood_memory_desc: "Comparte una historia de 60 segundos de tu momento infantil m√°s feliz.",
          start_challenge: "Enviar Respuesta",
          pricing_title: "Elige Tu Plan Alegre",
          pricing_intro: "Comienza gratis o desbloquea funciones premium para crear recuerdos familiares inolvidables.",
          free_tier_title: "Legacy B√°sico",
          free_tier_desc: "Archivo limitado de texto y fotos, destacados de memoria IA, 5 interacciones IA/mes.",
          essential_tier_title: "Legacy Esencial",
          essential_tier_desc: "Almacenamiento expandido, persona IA personalizada, soporte multiling√ºe, b√∫squeda basada en estado de √°nimo.",
          family_tier_title: "Legacy Familiar Plus",
          family_tier_desc: "Archivos compartidos, √°lbumes colaborativos, interacciones IA ilimitadas, juegos familiares.",
          lifetime_tier_title: "B√≥veda de Legacy de Por Vida",
          lifetime_tier_desc: "Almacenamiento ilimitado, libro de legacy IA, soporte prioritario, mensajes programados, y **soporte VIP familiar exclusivo con curaciones de memoria IA personalizadas.**",
          buy_now: "Comprar Ahora",
          one_time_title: "Mejoras Premium",
          one_time_desc: "Agrega caracter√≠sticas √∫nicas a tu legacy alegre.",
          storybook_purchase: "Libro de Cuentos IA ($99)",
          time_capsule_purchase: "C√°psula del Tiempo ($49)",
          video_message_purchase: "Video de Legacy ($79)",
          business_creator_title: "Para Negocios y Creadores",
          business_creator_desc: "Preserva historias de marca o crea personas IA √∫nicas.",
          business_plan: "Plan de Negocios: $499/a√±o",
          creator_plan: "Plan de Creador: $99 configuraci√≥n + $25/mes",
          community_plan: "B√≥veda Comunitaria: $149/a√±o",
          contact_sales: "Contactar Ventas",
          login_title: "Inicio de Sesi√≥n en Portal Alegre",
          email_label: "Correo Electr√≥nico",
          email_input_placeholder: "Correo Electr√≥nico",
          password_label: "Contrase√±a",
          password_input_placeholder: "Contrase√±a",
          login_button: "Iniciar Sesi√≥n",
          forgot_password: "¬øOlvidaste la Contrase√±a?",
          email_required: "Por favor ingresa tu direcci√≥n de correo electr√≥nico.",
          password_reset_sent: "Correo de restablecimiento de contrase√±a enviado! Revisa tu bandeja de entrada.",
          login_required: "Por favor inicia sesi√≥n para grabar un...",
          current_plan: "Est√°s en {{planName}} üíõ",
          welcome_user: "Bienvenido, !",
          happy_timeline_title: "Tu L√≠nea de Tiempo Feliz",
          happy_timeline_desc: "Agrega hitos, primeros y momentos alegres a tu √°lbum digital.",
          add_milestone: "Agregar Hito",
          bucket_list_title: "Lista de Deseos Familiar",
          bucket_list_desc: "Establece metas compartidas como viajes o actividades divertidas y rastrea el progreso!",
          add_goal_placeholder: "Agregar una meta...",
          add_goal: "Agregar Meta",
          storytelling_mode_title: "Aventura de Narraci√≥n IA",
          storytelling_mode_desc: "Tu copiloto en la creaci√≥n del viaje √∫nico de tu familia, creando historias ficticias divertidas con tus seres queridos como h√©roes!",
          story_characters_label: "¬øQui√©nes son los personajes principales?",
          story_characters_placeholder: "e.g., Mam√°, Pap√°, Lily, nuestro perro Sparky",
          story_theme_label: "Elige un tema:",
          select_theme_option: "Selecciona un tema",
          generate_story: "Generar Historia",
          challenge_response_title: "Responder a Desaf√≠os",
          challenge_response_desc: "Ver y responder a desaf√≠os familiares.",
          view_challenges: "Ver Desaf√≠os",
          account_settings_title: "Configuraciones de Cuenta",
          account_settings_desc: "Gestiona tu perfil, suscripci√≥n y preferencias.",
          manage_settings: "Gestionar Configuraciones",
          contact_support_title: "Soporte",
          contact_support_desc: "Obt√©n ayuda o proporciona retroalimentaci√≥n.",
          contact_us: "Cont√°ctanos",
          logout_button: "Cerrar Sesi√≥n",
          demo_timeline_title: "Vista Previa de una L√≠nea de Tiempo Feliz",
          demo_timeline_desc: "¬°Ve c√≥mo Legacy AI da vida a los recuerdos!",
          login_to_create: "Inicia Sesi√≥n para Crear Tu Propio",
          signup_title: "Reg√≠strate en el Portal Alegre",
          signup_button: "Reg√≠strate",
          signup_link: "Reg√≠strate",
          login_link: "¬øYa tienes una cuenta? Iniciar Sesi√≥n"
      },
      fr: {
          home_title: "Capturez les Moments Joyeux de la Vie avec Legacy AI",
          home_lead: "Revivez le pass√©, c√©l√©brez le pr√©sent et fa√ßonnez l'avenir avec une bonheur cur√© par IA. Cr√©ez Ensemble, Souvenez-vous Pour Toujours : Construisez des albums num√©riques vibrants et des chronologies heureuses pour les g√©n√©rations.",
          get_started_free: "Commencer Gratuitement",
          download_joyful_guide: "T√©l√©charger le Guide de M√©moire Joyeuse",
          how_it_works_title: "Comment Legacy AI Diffuse la Joie",
          capture_moments_step: "1. Capturez des Moments Heureux",
          capture_moments_desc: "T√©l√©chargez des photos, vid√©os et notes vocales d'anniversaires, voyages et joies quotidiennes.",
          create_adventures_step: "2. Cr√©ez des Aventures Familiales",
          create_adventures_desc: "IA cr√©e des histoires interactives et des jeux mettant en vedette vos proches.",
          build_timeline_step: "3. Construisez une Chronologie Heureuse",
          build_timeline_desc: "Organisez les jalons dans un album num√©rique vibrant pour que tous le ch√©rissent.",
          moments_title: "Moments Qui Comptent",
          moments_intro: "Revivez la joie des anniversaires, voyages familiaux, blagues internes et moments quotidiens. T√©l√©chargez vos souvenirs les plus heureux pour cr√©er un album num√©rique qui provoque des sourires.",
          upload_photos_title: "Photos de Joie",
          upload_photos_desc: "Partagez des instantan√©s de rires et d'amour.",
          record_voice_title: "Notes Vocales",
          record_voice_desc: "Capturez des blagues, chansons ou messages sinc√®res.",
          share_videos_title: "Vid√©os Heureuses",
          share_videos_desc: "T√©l√©chargez des clips de c√©l√©brations et d'aventures.",
          emotion_tag_placeholder: "Taggez des √©motions ou th√®mes (e.g., #joyeux, #aventure)",
          upload_now: "T√©l√©charger Maintenant",
          record_now: "Enregistrer Maintenant",
          stop_recording: "Arr√™ter l'Enregistrement",
          upload_failed: "T√©l√©chargement √©chou√© :",
          upload_success: "Note vocale t√©l√©charg√©e avec succ√®s ! Conversion MP3 en cours.",
          mp3_conversion_failed: "Note vocale t√©l√©charg√©e, mais conversion MP3 √©chou√©e. Lecture WebM.",
          microphone_error: "Acc√®s au microphone refus√© ou indisponible : ",
          challenges_title: "D√©fis Familiaux Interactifs",
          challenges_intro: "Rapprochez votre famille avec des prompts amusants qui cr√©ent des souvenirs joyeux. Compl√©tez des d√©fis et construisez un archive positif ensemble !",
          funny_question_title: "D√©fi de Question Dr√¥le",
          funny_question_desc: "Posez une question hilarante √† vos grands-parents aujourd'hui et enregistrez leur r√©ponse !",
          dance_off_title: "Danse Familiale",
          dance_off_desc: "Enregistrez une danse familiale de 60 secondes et partagez le fun !",
          childhood_memory_title: "Histoire de Souvenir d'Enfance",
          childhood_memory_desc: "Partagez une histoire de 60 secondes de votre moment d'enfance le plus heureux.",
          start_challenge: "Soumettre la R√©ponse",
          pricing_title: "Choisissez Votre Plan Joyeux",
          pricing_intro: "Commencez gratuitement ou d√©bloquez des fonctionnalit√©s premium pour cr√©er des souvenirs familiaux inoubliables.",
          free_tier_title: "Legacy Basique",
          free_tier_desc: "Archive limit√©e de texte et photos, faits saillants de m√©moire IA, 5 interactions IA/mois.",
          essential_tier_title: "Legacy Essentiel",
          essential_tier_desc: "Stockage √©tendu, persona IA personnalis√©e, support multilingue, recherche bas√©e sur l'humeur.",
          family_tier_title: "Legacy Familial Plus",
          family_tier_desc: "Archives partag√©es, albums collaboratifs, interactions IA illimit√©es, jeux familiaux.",
          lifetime_tier_title: "Vo√ªte Legacy √† Vie",
          lifetime_tier_desc: "Stockage illimit√©, livre legacy IA, support prioritaire, messages programm√©s, et **support VIP familial exclusif avec curations de m√©moire IA personnalis√©es.**",
          buy_now: "Acheter Maintenant",
          one_time_title: "Am√©liorations Premium",
          one_time_desc: "Ajoutez des fonctionnalit√©s uniques √† votre legacy joyeuse.",
          storybook_purchase: "Livre de Contes IA ($99)",
          time_capsule_purchase: "Capsule Temporelle ($49)",
          video_message_purchase: "Vid√©o Legacy ($79)",
          business_creator_title: "Pour les Entreprises & Cr√©ateurs",
          business_creator_desc: "Pr√©servez les histoires de marque ou cr√©ez des personas IA uniques.",
          business_plan: "Plan d'Entreprise : $499/an",
          creator_plan: "Plan Cr√©ateur : $99 configuration + $25/mois",
          community_plan: "Vo√ªte Communautaire : $149/an",
          contact_sales: "Contacter les Ventes",
          login_title: "Connexion au Portail Joyeux",
          email_label: "Email",
          email_input_placeholder: "Email",
          password_label: "Mot de Passe",
          password_input_placeholder: "Mot de Passe",
          login_button: "Se Connecter",
          forgot_password: "Mot de Passe Oubli√© ?",
          email_required: "Veuillez entrer votre adresse email.",
          password_reset_sent: "Email de r√©initialisation de mot de passe envoy√© ! V√©rifiez votre bo√Æte de r√©ception.",
          login_required: "Veuillez vous connecter pour enregistrer un...",
          current_plan: "Vous √™tes sur {{planName}} üíõ",
          welcome_user: "Bienvenue, !",
          happy_timeline_title: "Votre Chronologie Heureuse",
          happy_timeline_desc: "Ajoutez des jalons, des premiers et des moments joyeux √† votre album num√©rique.",
          add_milestone: "Ajouter un Jalon",
          bucket_list_title: "Liste de Souhaits Familiale",
          bucket_list_desc: "D√©finissez des objectifs partag√©s comme des voyages ou des activit√©s amusantes et suivez le progr√®s !",
          add_goal_placeholder: "Ajouter un objectif...",
          add_goal: "Ajouter un Objectif",
          storytelling_mode_title: "Aventure de Narration IA",
          storytelling_mode_desc: "Votre copilote pour cr√©er le voyage unique de votre famille, en cr√©ant des histoires fictives amusantes avec vos proches comme h√©ros !",
          story_characters_label: "Qui sont les personnages principaux ?",
          story_characters_placeholder: "e.g., Maman, Papa, Lily, notre chien Sparky",
          story_theme_label: "Choisissez un th√®me :",
          select_theme_option: "S√©lectionnez un th√®me",
          generate_story: "G√©n√©rer l'Histoire",
          challenge_response_title: "R√©pondre aux D√©fis",
          challenge_response_desc: "Voir et r√©pondre aux d√©fis familiaux.",
          view_challenges: "Voir les D√©fis",
          account_settings_title: "Param√®tres du Compte",
          account_settings_desc: "G√©rez votre profil, abonnement et pr√©f√©rences.",
          manage_settings: "G√©rer les Param√®tres",
          contact_support_title: "Support",
          contact_support_desc: "Obtenez de l'aide ou fournissez des commentaires.",
          contact_us: "Nous Contacter",
          logout_button: "Se D√©connecter",
          demo_timeline_title: "Aper√ßu d'une Chronologie Heureuse",
          demo_timeline_desc: "Voyez comment Legacy AI donne vie aux souvenirs !",
          login_to_create: "Se Connecter pour Cr√©er le V√¥tre",
          signup_title: "Inscrivez-vous au Portail Joyeux",
          signup_button: "S'inscrire",
          signup_link: "S'inscrire",
          login_link: "D√©j√† un compte ? Se Connecter"
      },
      de: {
          // Add translations for German if needed, but since not provided, leave empty or add placeholders
      },
      pt: {
          // Add translations for Portuguese if needed, but since not provided, leave empty or add placeholders
      }
  };

  function applyTranslations() {
      document.querySelectorAll('[data-key]').forEach(el => {
          const key = el.getAttribute('data-key');
          if (translations[currentLang][key]) {
              el.textContent = translations[currentLang][key];
          }
      });
      document.querySelectorAll('[data-placeholder-key]').forEach(el => {
          const key = el.getAttribute('data-placeholder-key');
          if (translations[currentLang][key]) {
              el.placeholder = translations[currentLang][key];
          }
      });
      // To fix bug with elements containing inner HTML (e.g., welcome_user with span)
      if (document.getElementById('userName')) {
          document.querySelector('[data-key="welcome_user"]').innerHTML = translations[currentLang].welcome_user.replace('!', '<span id="userName"></span>!');
      }
  }

  document.querySelectorAll('.dropdown-item[data-lang]').forEach(item => {
      item.addEventListener('click', function(e) {
          e.preventDefault();
          currentLang = this.getAttribute('data-lang');
          applyTranslations();
      });
  });

  applyTranslations();

  document.querySelectorAll('a[data-page]').forEach(link => {
      link.addEventListener('click', function(e) {
          e.preventDefault();
          document.querySelectorAll('.page-section').forEach(section => {
              section.classList.remove('active');
          });
          const targetPage = this.getAttribute('data-page');
          document.getElementById(targetPage).classList.add('active');

          if (targetPage === 'client-portal') {
              authService.onAuthStateChanged(user => {
                  if (user) {
                      document.getElementById('login-form').style.display = 'none';
                      document.getElementById('signup-form').style.display = 'none';
                      document.getElementById('dashboard-content').style.display = 'block';
                      document.getElementById('userName').textContent = user.email;
                      updatePlanStatus(user.uid);
                  } else {
                      document.getElementById('login-form').style.display = 'block';
                      document.getElementById('signup-form').style.display = 'none';
                      document.getElementById('dashboard-content').style.display = 'none';
                  }
              });
          }
      });
  });

  document.getElementById('showSignup').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('login-form').style.display = 'none';
      document.getElementById('signup-form').style.display = 'block';
  });

  document.getElementById('showLogin').addEventListener('click', function(e) {
      e.preventDefault();
      document.getElementById('signup-form').style.display = 'none';
      document.getElementById('login-form').style.display = 'block';
  });

  document.getElementById('loginForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('clientEmail').value;
      const password = document.getElementById('clientPassword').value;
      try {
          await signInWithEmailAndPassword(authService, email, password);
          showToast('Logged in successfully!', 'success');
          document.getElementById('login-form').style.display = 'none';
          document.getElementById('dashboard-content').style.display = 'block';
          document.getElementById('userName').textContent = authService.currentUser.email;
          updatePlanStatus(authService.currentUser.uid);
      } catch (error) {
          showToast(`Login failed: ${error.message}`, 'error');
          console.error('Login error:', error);
      }
  });

  document.getElementById('signupForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      const email = document.getElementById('signupEmail').value;
      const password = document.getElementById('signupPassword').value;
      try {
          await createUserWithEmailAndPassword(authService, email, password);
          showToast('Signed up successfully!', 'success');
          document.getElementById('signup-form').style.display = 'none';
          document.getElementById('dashboard-content').style.display = 'block';
          document.getElementById('userName').textContent = authService.currentUser.email;
          await setDoc(doc(firestore, 'users', authService.currentUser.uid), { plan: 'basic' });
          updatePlanStatus(authService.currentUser.uid);
      } catch (error) {
          showToast(`Signup failed: ${error.message}`, 'error');
          console.error('Signup error:', error);
      }
  });

  document.getElementById('logoutButton').addEventListener('click', async function(e) {
      e.preventDefault();
      try {
          await signOut(authService);
          showToast('Logged out successfully!', 'info');
          document.getElementById('login-form').style.display = 'block';
          document.getElementById('dashboard-content').style.display = 'none';
      } catch (error) {
          showToast(`Logout failed: ${error.message}`, 'error');
          console.error('Logout error:', error);
      }
  });

  document.querySelector('[data-key="forgot_password"]').addEventListener('click', async function(e) {
      e.preventDefault();
      const email = document.getElementById('clientEmail').value;
      if (email) {
          try {
              await sendPasswordResetEmail(authService, email);
              showToast(translations[currentLang].password_reset_sent, 'info');
          } catch (error) {
              showToast(`Password reset failed: ${error.message}`, 'error');
              console.error('Password reset error:', error);
          }
      } else {
          showToast(translations[currentLang].email_required, 'error');
      }
  });

  async function updatePlanStatus(userId) {
      const planStatusElement = document.getElementById('plan-status');
      try {
          const userDoc = await getDoc(doc(firestore, 'users', userId));
          if (userDoc.exists() && userDoc.data().plan) {
              const planName = userDoc.data().plan;
              planStatusElement.textContent = translations[currentLang].current_plan.replace('{{planName}}', planName);
              planStatusElement.style.display = 'block';
          } else {
              planStatusElement.style.display = 'none';
          }
      } catch (error) {
          console.error("Error fetching plan status:", error);
          planStatusElement.style.display = 'none';
      }
  }

  async function uploadFile(file, type, emotionTagsInputId, progressBarId, progressContainerId) {
      if (!authService.currentUser) {
          showToast(translations[currentLang].login_required, 'error');
          return;
      }

      const storageRef = ref(storageService, `${type}s/${authService.currentUser.uid}/${file.name}`);
      const uploadTask = uploadBytes(storageRef, file);

      const progressBar = document.getElementById(progressBarId);
      const progressContainer = document.getElementById(progressContainerId);
      progressContainer.style.display = 'block';

      uploadTask.then(async (snapshot) => {
          const downloadURL = await getDownloadURL(snapshot.ref);
          showToast(`${type} uploaded successfully!`, 'success');
          progressContainer.style.display = 'none';
          const emotionTags = document.getElementById(emotionTagsInputId).value;
          await addDoc(collection(firestore, 'users', authService.currentUser.uid, type), {
              fileName: file.name,
              fileType: file.type,
              downloadURL: downloadURL,
              emotionTags: emotionTags,
              timestamp: serverTimestamp()
          });
          document.getElementById(emotionTagsInputId).value = '';
      }).catch((error) => {
          showToast(`${translations[currentLang].upload_failed} ${error.message}`, 'error');
          console.error("Upload failed:", error);
          progressContainer.style.display = 'none';
      });
  }

  document.getElementById('uploadPhotoButton').addEventListener('click', function() {
      const fileInput = document.getElementById('uploadPhotoInput');
      if (fileInput.files.length > 0) {
          Array.from(fileInput.files).forEach(file => {
              uploadFile(file, 'photo', 'photoEmotionInput', 'photoProgressBar', 'photoProgressContainer');
          });
          fileInput.value = '';
      } else {
          showToast('Please select a photo to upload.', 'info');
      }
  });

  document.getElementById('uploadVideoButton').addEventListener('click', function() {
      const fileInput = document.getElementById('uploadVideoInput');
      if (fileInput.files.length > 0) {
          Array.from(fileInput.files).forEach(file => {
              uploadFile(file, 'video', 'videoEmotionInput', 'videoProgressBar', 'videoProgressContainer');
          });
          fileInput.value = '';
      } else {
          showToast('Please select a video to upload.', 'info');
      }
  });

  document.getElementById('recordVoiceButton').addEventListener('click', async function() {
      if (!authService.currentUser) {
          showToast(translations[currentLang].login_required, 'error');
          return;
      }

      try {
          const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
          mediaRecorder = new MediaRecorder(stream);
          audioChunks = [];
          let timerSeconds = 0;
          const recordingTimer = document.getElementById('recordingTimer');

          mediaRecorder.ondataavailable = (event) => {
              audioChunks.push(event.data);
          };

          mediaRecorder.onstop = async () => {
              audioBlob = new Blob(audioChunks, { type: 'audio/webm' });
              const audioUrl = URL.createObjectURL(audioBlob);
              const audioPreview = document.getElementById('audioPreview');
              audioPreview.src = audioUrl;
              audioPreview.style.display = 'block';

              const fileName = `voice_note_${new Date().getTime()}.webm`;
              await uploadFile(audioBlob, 'voice', 'voiceEmotionInput', 'voiceProgressBar', 'voiceProgressContainer');

              clearInterval(recordingTimerInterval);
              recordingTimer.style.display = 'none';
              document.getElementById('recordVoiceButton').style.display = 'block';
              document.getElementById('stopRecordingButton').style.display = 'none';
          };

          mediaRecorder.start();
          recordingStartTime = Date.now();
          recordingTimer.textContent = '00:00';
          recordingTimer.style.display = 'block';
          document.getElementById('recordVoiceButton').style.display = 'none';
          document.getElementById('stopRecordingButton').style.display = 'block';

          recordingTimerInterval = setInterval(() => {
              timerSeconds = Math.floor((Date.now() - recordingStartTime) / 1000);
              const minutes = String(Math.floor(timerSeconds / 60)).padStart(2, '0');
              const seconds = String(timerSeconds % 60).padStart(2, '0');
              recordingTimer.textContent = `${minutes}:${seconds}`;
          }, 1000);

      } catch (error) {
          showToast(`${translations[currentLang].microphone_error} ${error.message}`, 'error');
          console.error("Microphone access error:", error);
      }
  });

  document.getElementById('stopRecordingButton').addEventListener('click', function() {
      if (mediaRecorder && mediaRecorder.state === 'recording') {
          mediaRecorder.stop();
          mediaRecorder.stream.getTracks().forEach(track => track.stop());
      }
  });

  document.querySelectorAll('[data-challenge-id]').forEach(button => {
      button.addEventListener('click', async function() {
          if (!authService.currentUser) {
              showToast(translations[currentLang].login_required, 'error');
              return;
          }

          const challengeId = this.dataset.challengeId;
          let responseData = {};

          switch (challengeId) {
              case 'funny-question':
                  responseData.answer = document.getElementById('funnyQuestionResponse').value;
                  if (!responseData.answer) {
                      showToast('Please enter an answer for the funny question challenge.', 'info');
                      return;
                  }
                  break;
              case 'dance-off':
                  const videoFile = document.getElementById('danceOffVideoInput').files[0];
                  if (!videoFile) {
                      showToast('Please upload a video for the dance-off challenge.', 'info');
                      return;
                  }
                  await uploadFile(videoFile, 'challenge_video', '', 'videoProgressBar', 'videoProgressContainer');
                  responseData.videoUploaded = true;
                  break;
              case 'childhood-memory':
                  responseData.story = document.getElementById('childhoodMemoryResponse').value;
                  if (!responseData.story) {
                      showToast('Please enter your story for the childhood memory challenge.', 'info');
                      return;
                  }
                  break;
          }

          try {
              await addDoc(collection(firestore, 'users', authService.currentUser.uid, 'challenges'), {
                  challengeId: challengeId,
                  responseData: responseData,
                  timestamp: serverTimestamp()
              });
              showToast('Challenge response submitted!', 'success');
              if (challengeId === 'funny-question') document.getElementById('funnyQuestionResponse').value = '';
              if (challengeId === 'dance-off') document.getElementById('danceOffVideoInput').value = '';
              if (challengeId === 'childhood-memory') document.getElementById('childhoodMemoryResponse').value = '';
          } catch (error) {
              showToast(`Challenge submission failed: ${error.message}`, 'error');
              console.error('Challenge submission error:', error);
          }
      });
  });

  document.getElementById('addMilestoneButton').addEventListener('click', async function() {
      if (!authService.currentUser) {
          showToast(translations[currentLang].login_required, 'error');
          return;
      }
      const milestone = prompt('Enter your milestone:');
      if (milestone) {
          try {
              await addDoc(collection(firestore, 'users', authService.currentUser.uid, 'timeline'), {
                  milestone: milestone,
                  timestamp: serverTimestamp()
              });
              showToast('Milestone added!', 'success');
          } catch (error) {
              showToast(`Failed to add milestone: ${error.message}`, 'error');
          }
      }
  });

  document.getElementById('addGoalButton').addEventListener('click', async function() {
      if (!authService.currentUser) {
          showToast(translations[currentLang].login_required, 'error');
          return;
      }
      const goal = document.getElementById('goalInput').value;
      if (goal) {
          try {
              await addDoc(collection(firestore, 'users', authService.currentUser.uid, 'bucketList'), {
                  goal: goal,
                  completed: false,
                  timestamp: serverTimestamp()
              });
              showToast('Goal added!', 'success');
              document.getElementById('goalInput').value = '';
          } catch (error) {
              showToast(`Failed to add goal: ${error.message}`, 'error');
          }
      } else {
          showToast('Please enter a goal.', 'info');
      }
  });

  document.getElementById('generateStoryButton').addEventListener('click', async function() {
      if (!authService.currentUser) {
          showToast(translations[currentLang].login_required, 'error');
          return;
      }
      const characters = document.getElementById('storyCharacters').value;
      const theme = document.getElementById('storyTheme').value;
      if (!characters || !theme) {
          showToast('Please enter characters and select a theme.', 'info');
          return;
      }

      showToast('Generating your story...', 'info');
      const storyOutput = document.getElementById('storyOutput');
      storyOutput.textContent = `Once upon a time, in a land far away, ${characters} embarked on a grand ${theme} adventure... (This is a placeholder story generated by AI.)`;
      storyOutput.style.display = 'block';
      document.getElementById('storyActions').style.display = 'flex';
      showToast('Story generated!', 'success');
  });

  document.getElementById('saveStoryButton').addEventListener('click', async function() {
      if (!authService.currentUser) return;
      const storyContent = document.getElementById('storyOutput').textContent;
      try {
          await addDoc(collection(firestore, 'users', authService.currentUser.uid, 'stories'), {
              content: storyContent,
              timestamp: serverTimestamp()
          });
          showToast('Story saved!', 'success');
      } catch (error) {
          showToast(`Failed to save story: ${error.message}`, 'error');
          console.error('Error saving story:', error);
      }
  });

  document.getElementById('shareStoryButton').addEventListener('click', function() {
      if (!authService.currentUser) return;
      const storyContent = document.getElementById('storyOutput').textContent;
      navigator.clipboard.writeText(storyContent).then(() => {
          showToast('Story copied to clipboard!', 'info');
      }).catch(err => {
          showToast('Failed to copy story.', 'error');
          console.error('Could not copy text: ', err);
      });
  });

  document.getElementById('regenerateStoryButton').addEventListener('click', function() {
      document.getElementById('generateStoryButton').click();
  });

  async function createPayPalOrder(amount, planName) {
      const response = await fetch('https://us-central1-life-archive-1ed4a.cloudfunctions.net/createOrder', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify({
              amount: amount,
              plan: planName
          })
      });
      if (!response.ok) {
          throw new Error('Failed to create order');
      }
      const data = await response.json();
      return data.id;
  }

  async function onPayPalApprove(data) {
      const response = await fetch('https://us-central1-life-archive-1ed4a.cloudfunctions.net/captureOrder', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json'
          },
          body: JSON.stringify({
              orderID: data.orderID
          })
      });
      if (!response.ok) {
          throw new Error('Failed to capture order');
      }
      const details = await response.json();
      showToast(`Transaction completed!`, 'success');
      // Update user plan in Firestore or handle subscription
      if (authService.currentUser) {
          await updateDoc(doc(firestore, 'users', authService.currentUser.uid), {
              plan: details.purchase_units[0].reference_id // assuming planName stored there
          });
      }
      return details;
  }

  function onPayPalError(err) {
      showToast(`Payment failed: ${err.message || err}`, 'error');
      console.error('PayPal error:', err);
  }

  function initPayPalButtons(containerId, amount, planName) {
      paypal.Buttons({
          style: {
              layout: 'vertical',
              color: 'blue',
              shape: 'rect',
              label: 'paypal'
          },
          createOrder: () => createPayPalOrder(amount, planName),
          onApprove: onPayPalApprove,
          onError: onPayPalError
      }).render(`#${containerId}`);
  }

  function initCardFields(containerId, submitButtonId, amount, planName) {
      const cardFields = paypal.CardFields({
          createOrder: () => createPayPalOrder(amount, planName),
          onApprove: onPayPalApprove,
          onError: onPayPalError
      });
      if (cardFields.isEligible()) {
          cardFields.NumberField().render('#card-number-' + containerId.split('-')[1]);
          cardFields.ExpiryField().render('#card-expiry-' + containerId.split('-')[1]);
          cardFields.CVVField().render('#card-cvv-' + containerId.split('-')[1]);
          document.getElementById(submitButtonId).addEventListener('click', () => {
              cardFields.submit().catch(onPayPalError);
          });
      } else {
          document.getElementById(containerId).style.display = 'none';
      }
  }

  document.addEventListener('DOMContentLoaded', () => {
      initPayPalButtons('paypal-essential', '15.00', 'Essential');
      initCardFields('card-fields-essential', 'card-submit-essential', '15.00', 'Essential');
      initPayPalButtons('paypal-family', '39.00', 'Family Plus');
      initCardFields('card-fields-family', 'card-submit-family', '39.00', 'Family Plus');
      initPayPalButtons('paypal-lifetime', '299.00', 'Lifetime');
      initCardFields('card-fields-lifetime', 'card-submit-lifetime', '299.00', 'Lifetime');
      // For premium enhancements
      initPayPalButtons('paypal-storybook', '99.00', 'AI Storybook');
      initPayPalButtons('paypal-timecapsule', '49.00', 'Time Capsule');
      initPayPalButtons('paypal-legacyvideo', '79.00', 'Legacy Video');
      document.getElementById('current-year').textContent = new Date().getFullYear();
  });
</script>
</body>

</html>
